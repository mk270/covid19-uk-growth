#!/usr/bin/env python3

import datetime
import database
import sys
import scraper
import logging
import os

iso_date_fmt = "%Y-%m-%d"

def today_iso():
    return datetime.datetime.now().strftime(iso_date_fmt)

def run():
    if "DEBUG" in os.environ:
        logging.getLogger().setLevel(20)

    if database.already_done_today(today_iso()):
        print("Data already obtained for today")
        sys.exit(0)
    day, count = scraper.get_date_and_count()
    # date_diff = (datetime.datetime.now() - day).days

    day_formatted = datetime.datetime.strftime(day, iso_date_fmt)
    database.save_update(day_formatted, count)

if __name__ == '__main__':
   run()
